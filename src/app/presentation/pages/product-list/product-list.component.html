<!-- ============================================================
     ğŸ“ CAPA: PRESENTACIÃ“N
     ğŸ“„ ARCHIVO: product-list.component.html
     ============================================================
     Solo muestra datos y captura acciones del usuario.
     Toda la lÃ³gica estÃ¡ en el .ts y en los casos de uso.
     ============================================================ -->

<div class="page-container">

  <!-- CABECERA -->
  <div class="page-header">
    <div class="header-title">
      <h1>ğŸ“¦ GestiÃ³n de Productos</h1>
      <p class="subtitle">Arquitectura Hexagonal â€” Angular</p>
    </div>

    <!-- Resumen rÃ¡pido -->
    <div class="stats" *ngIf="!loading && products.length > 0">
      <div class="stat-badge">
        <span class="stat-number">{{ products.length }}</span>
        <span class="stat-label">Total</span>
      </div>
      <div class="stat-badge available">
        <span class="stat-number">{{ availableCount }}</span>
        <span class="stat-label">Disponibles</span>
      </div>
      <div class="stat-badge out">
        <span class="stat-number">{{ products.length - availableCount }}</span>
        <span class="stat-label">Sin Stock</span>
      </div>
    </div>

    <button class="btn-secondary" (click)="goToCategories()">
      ğŸ·ï¸ Ver CategorÃ­as
    </button>
    <button class="btn-primary" (click)="toggleForm()">
      {{ showForm ? 'âœ• Cancelar' : '+ Nuevo Producto' }}
    </button>
  </div>

  <!-- MENSAJES DE FEEDBACK -->
  <div class="alert success" *ngIf="successMessage">âœ… {{ successMessage }}</div>
  <div class="alert error" *ngIf="error">âŒ {{ error }}</div>

  <!-- ==================== FORMULARIO DE CREACIÃ“N ==================== -->
  <!-- Se muestra/oculta con showForm. Los datos van a newProduct -->
  <div class="form-card" *ngIf="showForm">
    <h2>â• Nuevo Producto</h2>

    <div class="alert error small" *ngIf="formError">{{ formError }}</div>

    <!-- Nombre -->
    <div class="form-group">
      <label>Nombre del producto *</label>
      <input
        type="text"
        [(ngModel)]="newProduct.name"
        placeholder="Ej: Laptop Dell XPS"
        class="form-input"
      />
    </div>

    <!-- Precio y Stock en fila -->
    <div class="form-row">
      <div class="form-group">
        <label>Precio (USD) *</label>
        <input
          type="number"
          [(ngModel)]="newProduct.price"
          placeholder="0.00"
          min="0"
          class="form-input"
        />
      </div>
      <div class="form-group">
        <label>Stock *</label>
        <input
          type="number"
          [(ngModel)]="newProduct.stock"
          placeholder="0"
          min="0"
          class="form-input"
        />
      </div>
    </div>

    <!-- CategorÃ­a -->
    <div class="form-group">
      <label>CategorÃ­a *</label>
      <select [(ngModel)]="newProduct.category" class="form-input">
        <option value="">-- Seleccionar --</option>
        <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
      </select>
    </div>

    <button class="btn-primary" (click)="createProduct()" [disabled]="saving">
      {{ saving ? 'Guardando...' : 'ğŸ’¾ Guardar Producto' }}
    </button>
  </div>

  <!-- ==================== ESTADO DE CARGA ==================== -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Cargando productos...</p>
    <small>Simulando latencia de red (500ms)</small>
  </div>

  <!-- ==================== LISTA VACÃA ==================== -->
  <div class="empty-state" *ngIf="!loading && products.length === 0 && !error">
    <p>ğŸ“­ No hay productos aÃºn</p>
    <button class="btn-primary" (click)="toggleForm()">Crear el primero</button>
  </div>

  <!-- ==================== GRID DE PRODUCTOS ==================== -->
  <div class="product-grid" *ngIf="!loading && products.length > 0">

    <div
      class="product-card"
      *ngFor="let product of products"
      [class.out-of-stock]="!isAvailable(product)"
      [class.expensive]="isExpensive(product)"
    >

      <!-- Badge de estado -->
      <div class="card-badges">
        <span class="badge red" *ngIf="!isAvailable(product)">Sin Stock</span>
        <span class="badge gold" *ngIf="isExpensive(product)">Premium</span>
        <span class="badge green" *ngIf="isAvailable(product) && !isExpensive(product)">Disponible</span>
      </div>

      <!-- Contenido -->
      <div class="card-category">{{ product.category }}</div>
      <h3 class="card-name">{{ product.name }}</h3>

      <div class="card-price">
        <span class="price-main">${{ product.price | number:'1.2-2' }}</span>
        <span class="price-discount" *ngIf="isAvailable(product)">
          con 10% desc: ${{ getPriceWithDiscount(product) | number:'1.2-2' }}
        </span>
      </div>

      <div class="card-stock">
        <!-- Muestra barra visual de stock -->
        <span [class.no-stock]="!isAvailable(product)">
          ğŸ“¦ Stock: {{ product.stock }} unidades
        </span>
      </div>

      <!-- Acciones -->
      <div class="card-actions">
        <button class="btn-danger small" (click)="deleteProduct(product)">
          ğŸ—‘ï¸ Eliminar
        </button>
      </div>
    </div>

  </div>

  <!-- ==================== LEYENDA ARQUITECTURA ==================== -->
  <!-- Esto es solo didÃ¡ctico para entender el flujo -->
  <div class="arch-legend">
    <h3>ğŸ—ï¸ Flujo de esta pantalla</h3>
    <div class="arch-flow">
      <div class="arch-step ui">
        <strong>PresentaciÃ³n</strong>
        <small>product-list.component</small>
      </div>
      <div class="arch-arrow">â†’</div>
      <div class="arch-step app">
        <strong>AplicaciÃ³n</strong>
        <small>GetProductsUseCase</small>
      </div>
      <div class="arch-arrow">â†’</div>
      <div class="arch-step domain">
        <strong>Dominio</strong>
        <small>ProductRepository (interfaz)</small>
      </div>
      <div class="arch-arrow">â†’</div>
      <div class="arch-step infra">
        <strong>Infraestructura</strong>
        <small>ProductMockRepository</small>
      </div>
    </div>
  </div>

</div>
