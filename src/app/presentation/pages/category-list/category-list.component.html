<div class="page-container">
  <div class="page-header">
    <div>
      <h1>Categorias</h1>
      <p class="subtitle">{{ categoryCount() }} categorias en total</p>
    </div>
    <button class="btn-primary" (click)="toggleForm()">
      {{ showForm() ? "Cancelar" : "Nueva Categoria" }}
    </button>
  </div>

  @if (successMessage()) {
    <div class="alert success">{{ successMessage() }}</div>
  }

  @if (error()) {
    <div class="alert error">{{ error() }}</div>
  }

  @if (showForm()) {
    <div class="form-card">
      <h2>Nueva Categoria</h2>

      @if (formError()) {
        <div class="alert error small">{{ formError() }}</div>
      }

      <div class="form-group">
        <label>Nombre *</label>
        <input
          type="text"
          [ngModel]="draftName()"
          (ngModelChange)="draftName.set($event)"
          placeholder="Ej: Software"
          class="form-input"
        />
      </div>

      <div class="form-group">
        <label>Descripcion *</label>
        <input
          type="text"
          [ngModel]="draftDescription()"
          (ngModelChange)="draftDescription.set($event)"
          placeholder="Describe la categoria"
          class="form-input"
        />
      </div>

      <button class="btn-primary" (click)="createCategory()" [disabled]="saving()">
        {{ saving() ? "Guardando..." : "Guardar" }}
      </button>
    </div>
  }

  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando categorias...</p>
    </div>
  }

  @if (!loading()) {
    <div class="category-grid">
      @for (category of categories(); track category.id) {
        <div class="category-card" [class.empty]="!hasProducts(category)">
          <div class="card-icon">Categoria</div>
          <h3>{{ category.name }}</h3>
          <p class="description">{{ category.description }}</p>

          <div class="product-count" [class.zero]="!hasProducts(category)">
            {{ category.productCount }} productos
          </div>

          @if (!hasProducts(category)) {
            <span class="badge">Sin productos</span>
          }
        </div>
      }
    </div>
  }
</div>
